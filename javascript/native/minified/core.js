
Event.observe(window,'load',function(){var getForms=$$('.form-validate');if(getForms.length>0){var validate=new formValidation(getForms);}});formValidation=Class.create({initialize:function(data){this.validateForm=this.validateForm.bind(this);this.finalCheck=this.finalCheck.bind(this);data.invoke('observe','submit',this.validateForm);},validateForm:function(event){event.preventDefault();var formSubmited=Event.findElement(event);this.form=formSubmited.id;this.action=$(this.form).readAttribute('action');this.textFields=$(formSubmited).getInputs('text');this.passwordFields=$(formSubmited).getInputs('password');this.allElements=$(formSubmited).getInputs();this.validate();},validate:function(){var counter=0;var passCount=0;var checkLength='';var dbCheck='';errorCheck=$$('.error');errorCheck.each(function(index){$(index).remove();});this.allElements.each(function(index){checkLength=$(index).value.length;getType=$(index).readAttribute('type');if(checkLength===0){$(index).insert({after:'<span class="error">This field is required, you leave it empty.</span>'});counter++;if(getType==='password'){passCount++;}}else{if(getRepper=$(index).readAttribute('class').match(/(max|min)_\d+/)){getLengthRule=getRepper[0].split(/_/);}else{getLengthRule=0;}
if(getLengthRule!==0){counter++;if(getType=='password'){passCount++;}
if(getLengthRule[0]=='max'&&checkLength>getLengthRule[1]){$(index).insert({after:'<span class="error">This field must not contain more than <strong>'+getLengthRule[1]+'</strong>  characters</span>'});}else if(getLengthRule[0]=='min'&&checkLength<getLengthRule[1]){$(index).insert({after:'<span class="error">This field must contain at least <strong>'+getLengthRule[1]+'</strong>  characters</span>'});}else{if(index.id=='nick_name'){checkChars=/[a-zA-Z0-9_\.\-\,]+/;if(!checkChars.test($(index).value)){$(index).insert({after:'<span class="error">Nick name alowed chars: a-z, A-Z, 0-9 . , - _</span>'});}else{dbCheck+='nick_name='+$(index).value;}}else if(index.id=='full_name'){checkChars=/[a-zA-Z]+/;if(!checkChars.test($(index).value)){$(index).insert({after:'<span class="error">Nick name alowed chars: a-z, A-Z</span>'});}else{dbCheck+='&full_name='+$(index).value;}}else if(index.id=='e_mail'){filter=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!filter.test($(index).value)){counter++;$(index).insert({after:'<span class="error">This is not valid e-mail address.</span>'});}else{dbCheck+='&e_mail='+$(index).value;}}else{counter--;}
if(getType=='password'){passCount--;}else{counter--;}}}}});if(passCount==0){if($(this.passwordFields[0]).value!==$(this.passwordFields[1]).value){$(this.passwordFields[0]).insert({after:'<span class="error">Paswword fields do not match.</span>'});$(this.passwordFields[1]).insert({after:'<span class="error">Paswword fields do not match.</span>'});counter++;}}
if(counter==0&&passCount==0){finalCheck=this.finalCheck;params=$(this.form).serialize();formID=this.form;new Ajax.Request(this.action,{method:'post',parameters:params,onSuccess:function(transport){var message=transport.responseText.evalJSON();alert(message);if(message[0]!=='ok'){finalCheck(message);}else{if(formID=='update_user'){$('teModalBody').update('<div class="teModal-message">User Data updated</div>');setTimeout(function(){var teModalInt=new teModal();teModalInt.teModalCLOSE();window.location.href=message[1];},2000);}else{window.location.href=message[1];}}},onFailure:function(){alert('Something went wrong...');}});}},finalCheck:function(data){for(var key in data){$(key).insert({after:'<span class="error">'+data[key]+'</span>'});}}});